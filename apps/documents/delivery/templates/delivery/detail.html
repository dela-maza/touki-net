<!-- apps/documents/delivery/templates/delivery/detail.html -->
{% extends "_layout/page_base.html" %}

<!-- タイトル -->
{% block title %}納品書{% endblock %}

<!-- 専用スタイルシート -->
{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/documents/document.css') }}">
{% endblock %}

<!-- ヘッダーアイコン -->
{% block heading_icon %}
<img src="{{ url_for('static', filename='icon/24/package-dependents.svg') }}" alt="icon" width="20" height="20">
{% endblock %}

<!-- ヘッダータイトル -->
{% block heading %}
Delivery
{% endblock %}

<!-- ヘッダー右側：アクション -->
{% block header_actions %}
<a href="{{ url_for('client.documents_index', client_id=document.client.id) }}" class="btn icon">
    <img src="{{ url_for('static', filename='icon/16/file-directory.svg') }}" alt="">
</a>
<a href="{{ url_for('delivery.edit', document_id=document.id) }}" class="btn icon">
    <img src="{{ url_for('static', filename='icon/16/pencil.svg') }}" alt="">
</a>
<button type="button" class="btn icon" onclick="window.print()">
    <img src="{{ url_for('static', filename='icon/16/printer.svg') }}" alt="">
</button>
{% endblock %}

<!-- コンテンツ -->
{% block content %}


<div class="container document__container">
    <header class="section">
        <h1 class="page-title">納品書</h1>
        <div class="value sent-date">
            {% import "macros.html" as macros %}
            発信日：{{ macros.render_wareki_date(document.sent_date) if document.sent_date else '' }}
        </div>
        <!-- required と同じ meta-grid を流用 -->
        <div class="meta-grid">
            <div class="label">宛　名</div>
            <div class="value recipient">{{ document.client.name }} 様</div>
            <div class="value"></div>

            <div class="label">物件名</div>
            <div class="value">{{ document.entrusted_book_name }}</div>

            <div class="value">
                <address class="office-info">
                    <div>〒{{ office.post_code }}</div>
                    <div>{{ office.address|safe }}</div>
                    <div class="office-signet">
                        <img src="{{ url_for('static', filename='image/judicial-signet.jpg') }}"
                             alt="司法書士徽章" class="signet-icon">
                        <div class="signet-text">
                            <div>{{ office.affiliation }}</div>
                            <div class="office-name">{{ office.name }}</div>
                        </div>
                    </div>
                    <div>TEL：{{ office.tell }}</div>
                    <div>携帯：{{ office.mobile }}</div>
                    <div>Mail：{{ office.mail }}</div>
                </address>
            </div>
        </div>
    </header>

    <!-- 挨拶（上段） -->
    <section class="section">
        <div class="paragraph" style="border:none; padding:0;">
            {{ (document.greeting_paragraph or '') | replace('\n', '<br>') | safe }}
        </div>
    </section>

    <!-- 納品した書類（delivery は note 列なし／2列構成） -->
    <section class="section">
        <h2 class="table-caption text-center">納品書類</h2>
        <table class="list">
            <tbody>
            {% for row in (document.documents or []) %}
            {% set name = row.get('doc_name') or row.get('name') or '' %}
            {% set copies = row.get('copies','') %}
            {% if name or copies %}
            <tr>
                <td class="col-name">・ {{ name }}</td>
                <td class="col-copies">{{ copies }}</td>
            </tr>
            {% endif %}
            {% endfor %}
            </tbody>
        </table>
    </section>

    <!-- 結び（下段） -->
    <section class="section">
        <div class="paragraph" style="border:none; padding:0;">
            {{ (document.closing_paragraph or '') | replace('\n', '<br>') | safe }}
        </div>
    </section>
</div>
{% endblock %}
